# ZeroMQ pub/sub example

Написать две программы на Node.js; первая будет выступать в роли сервера, вторая - клиента. Взаимодействовать
они будут по [ZeroMQ](http://zeromq.org/). "Клиент" будет отправлять запросы на логин, а "сервер" - в зависимости
от данных в БД отвечать на эти запросы.

"Сервер" должен:

1. принять следующие аргументы командной строки: `pub`, `sub`
1. подключиться ZeroMQ pub-сокетом по TCP к хосту `127.0.0.1` на порт `pub` (socket.bindSync)
1. подключиться ZeroMQ sub-сокетом по TCP к хосту `127.0.0.1` на порт `sub` (socket.bindSync)
1. подключиться к БД (SQLite)
1. подписаться sub-сокетом на сообщения с первым фреймом `api_in`
1. при получении сообщения по sub-сокету
   1. распарсить джсон, переданный во втором фрейме сообщения
   1. если в джсоне поле `type` равно строке `"login"` 
      1. проверить пароль пользователя, основываясь на данных таблицы `user` (ее формат ниже)
      1. в зависимости от результата проверки отправить сообщение по pub-сокету (его формат ниже)

"Клиент" должен:

1. принять следующие аргументы командной строки: `pub`, `sub`
1. подключиться ZeroMQ pub-сокетом по TCP к хосту `127.0.0.1` на порт `sub` (socket.connect)
1. подключиться ZeroMQ sub-сокетом по TCP к хосту `127.0.0.1` на порт `pub` (socket.connect)
1. подписать sub-сокет на сообщения с первым фреймом `api_out`
1. при получении сообщения по sub-сокету
   1. распарсить джсон, переданный во втором фрейме сообщения
   1. если в джсоне поле `status` равно строке `"ok"` - вывести в консоль `"ok"`
   1. если в джсоне поле `status` равно строке `"error"` - вывести в консоль значение поля `error`
1. 	
1. запросить у пользователя пароль (через командную строку)
1. отправить через pub-сокет сообщение, у которого первый фрейм `api_in`, второй - json-строка 
   с полями type: 'login', email и pwd - данные от пользователя, msg_id - случайно сгенерированная строка.

### Модули

Для даного задания я использовал ряд модулей помимо `zeroMq`. Детальнее:
```
    "minimist": "^1.2.0",
    "nanoid": "^2.1.7",
    "readline": "^1.3.0",
    "sqlite3": "^4.1.0",
    "zeromq": "^5.1.0"
```
Из них: 

`nanoid` - легкий и быстрый модул для генерации рандомных ключей.

`minimist` - модуль для получения аргументов из командной строки.

`readline` - модуль для возможности получения введенных даных из консоли.

`sqlite3` - возможность работать с SQLITE.

### База данных

В базе находяться 4 записи:

```
{
   {email: greatjob@gmail.com
   passw: bingoBongo35}, 
   
   {email: twinkey@gmail.com
   passw: twinkeyGenius},
   
   {email: shalun@gmail.com
   passw: 6679023A},
   
   {email: harribo@gmail.com
   passw: jellymelly}
}
```

## Проблемы

В ходе выполнения задания возникал ряд проблем связанных с zeroMq:

1. Я не мог отправить 2 фрейма по типу `pub.send([first, second])` как было описано в документации. Пришлось совмещать оба фрейма вместе и при получение разделять их и парсить JSON. Сильно удивился, что оно сработало)
2. Возникали трудности при получении на сервер запроса от клиента при использовании `zeromq@6.0.0-beta.5`. По этой причине использовал версию 5.1.0

Не исключаю возможность появления данных проблем по моей вине. И хотел бы получить фидбэк со стороны более опытных товарищей.

## Заключение

Очень благодарен за данное тестовое задание. Это была хорошая возможность научиться новому. ZeroMQ произвел на меня крайне положительные емоции, но не отрицаю рассмотрение мною и других модулей.
Буду рад увидеть конструктивную критику по поводу проделанной работы.
